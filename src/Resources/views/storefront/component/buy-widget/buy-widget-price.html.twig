{% sw_extends '@Storefront/storefront/component/buy-widget/buy-widget-price.html.twig' %}

{% block buy_widget_price_inner %}
    {{ parent() }}
{% endblock %}

{% block buy_widget_price_block_table_body_cell_price %}
    <td class="product-block-prices-cell ">
        {% set basePrice = price.unitPrice %}
        {% set taxRate = 0 %}

        {% if price.calculatedTaxes is not empty %}
            {% set taxRate = price.calculatedTaxes.first.taxRate %}
        {% elseif price.taxRules is not empty %}
            {% set taxRate = price.taxRules.first.taxRate %}
        {% endif %}

        {% if taxRate > 0 %}
            {% if context.taxState == 'gross' %}
                {% set grossPrice = basePrice %}
                {% set netPrice = basePrice / (1 + (taxRate / 100)) %}
            {% else %}
                {% set netPrice = basePrice %}
                {% set grossPrice = basePrice * (1 + (taxRate / 100)) %}
            {% endif %}
        {% else %}
            {% set netPrice = basePrice %}
            {% set grossPrice = basePrice %}
        {% endif %}

        <span class="block-price-main">
            {{ netPrice|currency }}*
        </span>

        <span class="block-price-secondary text-muted fw-lighter">
            ({{ grossPrice|currency }} Brutto)
        </span>
    </td>
{% endblock %}